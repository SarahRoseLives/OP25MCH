ScreenManager:
    id: screen_manager
    Main:
        name: 'Main'
    SettingsOP25Config:
        name: 'SettingsOP25Config'
    SettingsLocalConfig:
        name: 'SettingsLocalConfig'
    SettingsScanGridConfig:
        name: 'SettingsScanGridConfig'
    SettingsRRCredentials:
        name: 'SettingsRRCredentials'
    SettingsRRImport:
        name: 'SettingsRRImport'
    SettingsRRSelect:
        name: 'SettingsRRSelect'



<Main@Screen>:
    MDBottomNavigation:
        id: panel
        MDBottomNavigationItem:
            name: "Screen1"
            text: "Large Display"
            icon: "monitor"
            BoxLayout:
                orientation: 'vertical'
                MDLabel:
                    text: "[font=material]" + app.signal_icon + "[/font]" + app.sdr_info
                    markup: True
                    font_size: '30sp'
                    halign: "center"
                    size_hint_y: None
                    height: self.texture_size[1]

                Label:
                    text: '========== ' + app.time_text + ' =========='
                    font_name: 'digital'  # Use a monospaced font
                    font_size: '30sp'
                    size_hint_y: None
                    height: self.texture_size[1]
                    halign: 'left'  # Left-align text
                    valign: 'middle'

                Label:
                    text: 'Not Connected'
                    id: connected_msg
                    font_name: 'digital'
                    font_size: '25sp'
                    size_hint_y: None
                    height: self.texture_size[1]
                    halign: 'left'  # Left-align text
                    valign: 'middle'
                    #on_touch_down: app.start_thread()

                Widget:  # This widget takes the remaining space


                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height  # Adjusts height to the content
                    padding: [100, 0]
                    pos_hint: {'center_y': 0.5}  # Centers the BoxLayout vertically

                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_y: None
                        height: self.minimum_height  # Adjusts height to the content

                        Label:
                            text: 'System Name'
                            id: system_name
                            font_name: 'digital'
                            font_size: '50sp'
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: 'left'  # Left-align text
                            valign: 'middle'



                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint_y: None
                            height: self.minimum_height

                            MDRaisedButton:
                                text: "-"
                                theme_text_color: "Custom"
                                text_color: (0.5, 0.5, 0.5, 1)
                                md_bg_color: (0.0706, 0.0706, 0.0706, 1)
                                size_hint_x: None
                                font_size: '50sp'
                                on_press: app.decrease_volume()
                                width: 50

                            Label:
                                text: 'Manual TSV Loaded'
                                id: system_county
                                font_name: 'digital'
                                font_size: '50sp'
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: 'left'  # Left-align text
                                valign: 'middle'

                            MDRaisedButton:
                                text: "+"
                                theme_text_color: "Custom"
                                text_color: (0.5, 0.5, 0.5, 1)
                                md_bg_color: (0.0706, 0.0706, 0.0706, 1)
                                size_hint_x: None
                                font_size: '50sp'
                                on_press: app.increase_volume()
                                width: 50


                        Label:
                            text: 'No Active Call'
                            id: current_talkgroup
                            font_name: 'digital'
                            font_size: '50sp'
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: 'left'  # Left-align text
                            valign: 'middle'


                Widget:  # This widget takes the remaining space



        MDBottomNavigationItem:
            name: "screen2"
            text: "Detailed Display"
            icon: "monitor-dashboard"

            BoxLayout:
                orientation: "vertical"

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(10)

                    Label:
                        text: "Pi25 Mobile Control Head A NAC: 0x343 | WACN: 0xbee00 | SYSID: Sys ID: 0x348 "
                        text_size: (None, None)
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: '20sp'
                    Label:
                        text: "Laketran CRT"
                        text_size: (None, None)
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: '40sp'
                    Label:
                        text: "OMMRC: Lake"
                        text_size: (None, None)
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: '40sp'
                    Label:
                        text: "Radio ID: 4351439"
                        text_size: (None, None)
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: '20sp'
                    Label:
                        text: "TalkGroup ID: 27684"
                        text_size: (None, None)
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: '20sp'


                ScrollView:
                    GridLayout:
                        cols: 1
                        size_hint_y: None
                        height: self.minimum_height
                        padding: dp(10)
                        row_default_height: '40dp'  # Set the default height for each row

                        Label:
                            text: "Laketran CRT.276844351439...2022-05-20 14:32:18.398200"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "SkyTransit CRT.234567890123...2022-07-19 18:36:15.678700"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "UrbanShuttle CRT.678901234567...2023-04-25 13:11:29.789500"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "CityRide CRT.345678901234...2022-09-03 16:28:07.345600"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "TransitX CRT.987654321098...2024-01-10 11:55:44.901200"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "RapidBus CRT.123456789012...2023-02-28 08:03:22.556300"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "MetroTrans CRT.509876543210...2022-11-15 17:20:50.123400"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'
                        Label:
                            text: "TramWay CRT.890123456789...2023-10-30 10:02:38.012600"
                            text_size: self.width, None
                            text_align: 'left'
                            valign: 'middle'
                            font_size: '15sp'


        MDBottomNavigationItem:
            name: "screen3"
            text: "ScanGrid"
            icon: "grid"

            BoxLayout:
                orientation: 'vertical'

                TabbedPanel:
                    do_default_tab: False
                    tab_height: sp(75)  # Adjust the tab height using sp units
                    # tab_width: sp(150)  # Adjust the tab width using sp units
                    tab_width: self.width / len(self.tab_list)

                    TabbedPanelItem:
                        text: 'Tab 1'
                        GridLayout:
                            cols: 3
                            rows: 4
                            spacing: 10
                            padding: 10
                            ToggleButton:
                                text: 'Button 1'
                            ToggleButton:
                                text: 'Button 2'
                            ToggleButton:
                                text: 'Button 3'
                            ToggleButton:
                                text: 'Button 4'
                            ToggleButton:
                                text: 'Button 5'
                            ToggleButton:
                                text: 'Button 6'
                            ToggleButton:
                                text: 'Button 7'
                            ToggleButton:
                                text: 'Button 8'
                            ToggleButton:
                                text: 'Button 9'

                    TabbedPanelItem:
                        text: 'Tab 2'
                        GridLayout:
                            cols: 3
                            rows: 4
                            spacing: 10
                            padding: 10
                            ToggleButton:
                                text: 'Button 10'
                            ToggleButton:
                                text: 'Button 11'
                            ToggleButton:
                                text: 'Button 12'
                            ToggleButton:
                                text: 'Button 13'
                            ToggleButton:
                                text: 'Button 14'
                            ToggleButton:
                                text: 'Button 15'
                            ToggleButton:
                                text: 'Button 16'
                            ToggleButton:
                                text: 'Button 17'
                            ToggleButton:
                                text: 'Button 18'

                    TabbedPanelItem:
                        text: 'Tab 3'
                        GridLayout:
                            cols: 3
                            rows: 4
                            spacing: 10
                            padding: 10
                            ToggleButton:
                                text: 'Button 19'
                            ToggleButton:
                                text: 'Button 20'
                            ToggleButton:
                                text: 'Button 21'
                            ToggleButton:
                                text: 'Button 22'
                            ToggleButton:
                                text: 'Button 23'
                            ToggleButton:
                                text: 'Button 24'
                            ToggleButton:
                                text: 'Button 25'
                            ToggleButton:
                                text: 'Button 26'
                            ToggleButton:
                                text: 'Button 27'

                    TabbedPanelItem:
                        text: 'Tab 4'
                        GridLayout:
                            cols: 3
                            rows: 4
                            spacing: 10
                            padding: 10
                            ToggleButton:
                                text: 'Button 28'
                            ToggleButton:
                                text: 'Button 29'
                            ToggleButton:
                                text: 'Button 30'
                            ToggleButton:
                                text: 'Button 31'
                            ToggleButton:
                                text: 'Button 32'
                            ToggleButton:
                                text: 'Button 33'
                            ToggleButton:
                                text: 'Button 34'
                            ToggleButton:
                                text: 'Button 35'
                            ToggleButton:
                                text: 'Button 36'

                    TabbedPanelItem:
                        text: 'Tab 5'
                        GridLayout:
                            cols: 3
                            rows: 4
                            spacing: 10
                            padding: 10
                            ToggleButton:
                                text: 'Button 37'
                            ToggleButton:
                                text: 'Button 38'
                            ToggleButton:
                                text: 'Button 39'
                            ToggleButton:
                                text: 'Button 40'
                            ToggleButton:
                                text: 'Button 41'
                            ToggleButton:
                                text: 'Button 42'
                            ToggleButton:
                                text: 'Button 43'
                            ToggleButton:
                                text: 'Button 44'
                            ToggleButton:
                                text: 'Button 45'

                    TabbedPanelItem:
                        text: 'Tab 6'
                        GridLayout:
                            cols: 3
                            rows: 4
                            spacing: 10
                            padding: 10
                            ToggleButton:
                                text: 'Button 46'
                            ToggleButton:
                                text: 'Button 47'
                            ToggleButton:
                                text: 'Button 48'
                            ToggleButton:
                                text: 'Button 49'
                            ToggleButton:
                                text: 'Button 50'
                            ToggleButton:
                                text: 'Button 51'
                            ToggleButton:
                                text: 'Button 52'
                            ToggleButton:
                                text: 'Button 53'
                            ToggleButton:
                                text: 'Button 54'


        MDBottomNavigationItem:
            name: "screen4"
            text: "Site Details"
            icon: "radio-tower"

            BoxLayout:
                orientation: 'vertical'

                Label:
                    text: "󰽅󰆣󰆤"
                    font_name: 'material'
                    font_size: '30sp'
                    size_hint_y: None
                    height: 50  # Set the height of the label

                Widget:
                    size_hint_y: None
                    height: 20  # This empty widget pushes the content below

                BoxLayout:
                    orientation: 'horizontal'

                    BoxLayout:
                        size_hint_x: 0.25  # 25% width
                        orientation: 'vertical'
                        Label:
                            text: 'Left Box󱖙󱖘󱖚󱖗'
                            font_name: 'material'
                            font_size: '30sp'
                            halign: 'center'

                    BoxLayout:
                        size_hint_x: 0.75  # 75% width
                        orientation: 'vertical'
                        Label:
                            text: 'Site ID: 32\r\nRF ID: 032\r\nWACN: 0x234'
                            markup: True
                            font_size: '30sp'

                    BoxLayout:
                        orientation: 'vertical'

                        Label:
                            text: 'Lat: '
                            id: lat

                        Label:
                            text: 'Lon: '
                            id: lon

                        Label:
                            text: 'Speed: '
                            id: speed

                        Label:
                            text: 'Bearing: '
                            id: bearing

                        Label:
                            text: 'Altitude: '
                            id: altitude

                        Label:
                            text: 'Accuracy: '
                            id: accuracy

                        Label:
                            text: 'Nearest Zip: '
                            id: nearest_zip

                        Label:
                            text: 'Nearest Site: '
                            id: nearest_site



                        Label:
                            text: app.gps_status

                        BoxLayout:
                            size_hint_y: None
                            height: '48dp'
                            padding: '4dp'

                            ToggleButton:
                                text: 'Start' if self.state == 'normal' else 'Stop'
                                on_state:
                                    app.start(1000, 0) if self.state == 'down' else \
                                    app.stop()




        MDBottomNavigationItem:
            name: "screen5"
            text: "Log"
            icon: "file-document-multiple"

            ScrollView:
                id: log_scrollview

                BoxLayout:
                    id: log_box
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(10)
                    spacing: dp(10)

                    # Example of adding a label manually
                    Label:
                        text: "Initial log entry"
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: '30sp'

        MDBottomNavigationItem:
            name: "screen6"
            text: "Settings"
            icon: "cog"
            MDScreen:
                ScrollView:
                    BoxLayout:
                        orientation: 'vertical'
                        padding: [20, 20, 20, 20]
                        spacing: 20
                        size_hint_y: None
                        height: self.minimum_height

                        MDLabel:
                            text: 'Main Settings'
                            font_size: sp(25)
                            text_size: self.size
                            halign: 'left'

                        MDList:
                            id: list
                            TwoLineAvatarListItem:
                                text: "Local Config"
                                secondary_text: "IP and Port Config"
                                on_release: app.root.current = 'SettingsLocalConfig'

                        MDList:
                            id: list
                            TwoLineAvatarListItem:
                                text: "OP25 Config"
                                secondary_text: "Manual Trunking Configuration"
                                on_release: app.root.current = 'SettingsOP25Config'

                        MDList:
                            id: list
                            TwoLineAvatarListItem:
                                text: "ScanGrid Config"
                                secondary_text: "ScanGrid Configuration"
                                on_release: app.root.current = 'SettingsScanGridConfig'

                        MDLabel:
                            text: 'Radio Reference'
                            font_size: sp(25)
                            text_size: self.size
                            halign: 'left'

                        MDList:
                            id: list
                            TwoLineAvatarListItem:
                                text: "Radio Reference Credentials"
                                secondary_text: "Login Information Saved Here"
                                on_release: app.root.current = 'SettingsRRCredentials'

                        MDList:
                            id: list
                            TwoLineAvatarListItem:
                                text: "Radio Reference Import"
                                secondary_text: "Import a System"
                                on_release: app.root.current = 'SettingsRRImport'


                        MDList:
                            id: list
                            TwoLineAvatarListItem:
                                text: "Imported System Selection"
                                secondary_text: "Select System"
                                on_release: app.root.current = 'SettingsRRSelect'



                        Widget:
                            size_hint_y: 0.5  # This will push the button down



# Define the SettingsLocalConfig Screen
<SettingsLocalConfig@Screen>:
    BoxLayout:
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: 0, 0, 0, 1  # Equivalent to #000000 in RGB
            Rectangle:
                size: self.size
                pos: self.pos

        MDTopAppBar:
            title: "Local Config"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        ScrollView:
            GridLayout:
                id: settings_grid
                cols: 2
                padding: "10dp"
                spacing: "10dp"
                size_hint_y: None
                height: self.minimum_height

                Label:
                    text: "OP25_IP"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    id: op25_ip_textbox
                    hint_text: "Enter OP25_IP address"
                    helper_text: "OP25_IP"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False

                Label:
                    text: "OP25_PORT"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    id: op25_port_textbox
                    hint_text: "Enter OP25_PORT"
                    helper_text: "OP25_PORT"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False

                Label:
                    text: "MCH_PORT"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    id: mch_port_textbox
                    hint_text: "Enter MCH_PORT"
                    helper_text: "MCH_PORT"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False


                Label:
                    text: "TIME24"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                MDCheckbox:
                    id: time24_checkbox
                    size_hint_y: None
                    height: "40dp"

                Label:
                    text: "Dark Mode"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                MDCheckbox:
                    id: darkmode_checkbox
                    size_hint_y: None
                    height: "40dp"

                Button:
                    text: "Update Config"
                    size_hint_y: None
                    height: "40dp"
                    on_release: app.update_config()  # Call update_config method


# Define the SettingsOP25Config Screen
<SettingsOP25Config@Screen>:
    BoxLayout:
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: 0, 0, 0, 1  # Equivalent to #000000 in RGB
            Rectangle:
                size: self.size
                pos: self.pos

        MDTopAppBar:
            title: "OP25 Config"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        ScrollView:
            GridLayout:
                id: settings_grid
                cols: 2
                padding: "10dp"
                spacing: "10dp"
                size_hint_y: None
                height: self.minimum_height

                Label:
                    text: "SDR Selection"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                Spinner:
                    id: sdr_spinner
                    text: "Choose an SDR"
                    values: ["RTL-SDR", "SDRplay", "HackRF", "Other"]
                    size_hint_y: None
                    height: "40dp"

                Label:
                    text: "Sample Rate"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                Spinner:
                    id: sample_rate_spinner
                    text: "Choose a sample rate"
                    values: ["1.4msps", "2.6msps"]
                    size_hint_y: None
                    height: "40dp"

                Label:
                    text: "Gain"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                Spinner:
                    id: gain_spinner
                    text: "Choose a gain"
                    values: [str(i) for i in range(10, 51, 2)]
                    size_hint_y: None
                    height: "40dp"

                Label:
                    text: "System Name"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    #id: op25_server_textbox
                    hint_text: "System Name Here"
                    id: op25_config_sysname
                    #helper_text: "OP25_SERVER"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False

                Label:
                    text: "Site Name"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    #id: op25_server_textbox
                    hint_text: "Site Name Here"
                    #helper_text: "OP25_SERVER"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False

                Label:
                    text: "Comma Seperated Control Channel Frequencies"
                    helper_text: "111.11111, 222.2222"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    id: op25_config_controlchannels
                    hint_text: "123.145678, 123.145678, 123.145678"
                    #helper_text: "OP25_SERVER"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False

                Label:
                    text: "TalkGroup List"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                TextInput:
                    id: op25_config_talkgroup_list
                    hint_text: "filename.tsv"
                    helper_text_mode: "on_focus"
                    size_hint_y: None
                    height: "40dp"
                    multiline: False

                Button:
                    text: "Read Config"
                    size_hint_y: None
                    height: "40dp"
                    on_release: app.read_op25_settings()

                Button:
                    text: "Write Config"
                    size_hint_y: None
                    height: "40dp"
                    on_release: app.update_op25_settings()

                Button:
                    text: "Start OP25"
                    size_hint_y: None
                    height: "40dp"
                    on_release: app.op25client.manual_start_op25()

                Button:
                    text: "Stop OP25"
                    size_hint_y: None
                    height: "40dp"
                    on_release: app.op25client.stop_op25()

                Label:
                    text: "Start OP25 on Boot"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                MDSwitch:
                    id: manual_on_boot
                    pos_hint: {'center_x': .5, 'center_y': .5}
                    width: dp(64)
                    on_touch_down: app.update_op25_settings()



# Define the SettingsScanGridConfig Screen
<SettingsScanGridConfig@Screen>:
    BoxLayout:
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: 0, 0, 0, 1  # Equivalent to #000000 in RGB
            Rectangle:
                size: self.size
                pos: self.pos

        MDTopAppBar:
            title: "ScanGrid Config"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        ScrollView:


<SettingsRRCredentials@Screen>:
    BoxLayout:
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: 0, 0, 0, 1  # Equivalent to #000000 in RGB
            Rectangle:
                size: self.size
                pos: self.pos

        MDTopAppBar:
            title: "Radio Reference Credentials"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        ScrollView:
            BoxLayout:
                orientation: 'vertical'
                padding: [20, 20, 20, 20]
                spacing: 20
                size_hint_y: None
                height: self.minimum_height

                GridLayout:
                    cols: 2
                    spacing: 20
                    size_hint_y: None
                    height: self.minimum_height

                    Label:
                        text: 'Username'
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.texture_size[1]

                    TextInput:
                        id: username
                        hint_text: "Radio Reference Username"
                        helper_text_mode: "on_focus"
                        multiline: False
                        size_hint_y: None
                        height: '40dp'

                    Label:
                        text: 'Password'
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.texture_size[1]

                    TextInput:
                        id: password
                        hint_text: "Radio Reference Password"
                        helper_text_mode: "on_focus"
                        multiline: False
                        password: True
                        size_hint_y: None
                        height: '40dp'

                Widget:
                    size_hint_y: 0.5

                Button:
                    text: 'Save Credentials and Return to Settings'
                    size_hint: (1, None)
                    height: '48dp'
                    on_press: app.save_rr_credentials()


<SettingsRRImport@Screen>:
    BoxLayout:
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: 0, 0, 0, 1  # Equivalent to #000000 in RGB
            Rectangle:
                size: self.size
                pos: self.pos

        MDTopAppBar:
            title: "Import a System"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        ScrollView:
            BoxLayout:
                orientation: 'vertical'
                padding: [20, 20, 20, 20]
                spacing: 20
                size_hint_y: None
                height: self.minimum_height

                GridLayout:
                    cols: 2
                    spacing: 20
                    size_hint_y: None
                    height: self.minimum_height

                    GridLayout:  # Wrap the TextInput and Button in a GridLayout
                        cols: 3
                        spacing: 20
                        size_hint_y: None


                        Label:
                            text: 'Zip Code'
                            size_hint_x: 0.3
                            size_hint_y: None
                            height: self.texture_size[1]

                        TextInput:
                            id: zipcode
                            hint_text: "Zip code"
                            helper_text_mode: "on_focus"
                            multiline: False
                            size_hint_y: None
                            height: '40dp'

                        Button:
                            text: "[font=material]󰤉[/font]"
                            markup: True
                            size_hint_y: None
                            height: '40dp'
                            font_size: '40sp'
                            on_release: app.gps_zipcode()

                Button:
                    text: 'Get Available Systems'
                    size_hint_y: None
                    height: '40dp'
                    on_release: app.update_rr_import_spinner(zipcode.text)

                Spinner:
                    id: import_system_spinner
                    text: "Select a System"
                    values: []
                    size_hint_y: None
                    height: "40dp"
                    opacity: 0 # This will be updated in python once systems are loaded

                Button:
                    id: download_system_button
                    text: 'Download System'
                    size_hint_y: None
                    height: '40dp'
                    on_release: app.download_rr_system(import_system_spinner.text)
                    opacity: 0 # Updated by rr_import_spinner


                Widget:
                    size_hint_y: 0.5


<SettingsRRSelect@Screen>:
    BoxLayout:
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: 0, 0, 0, 1  # Equivalent to #000000 in RGB
            Rectangle:
                size: self.size
                pos: self.pos

        MDTopAppBar:
            title: "Select Your System"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        ScrollView:
            BoxLayout:
                orientation: 'vertical'
                padding: [20, 20, 20, 20]
                spacing: 20
                size_hint_y: None
                height: self.minimum_height

                GridLayout:
                    cols: 2
                    spacing: 20
                    size_hint_y: None
                    height: self.minimum_height

                    Spinner:
                        id: systems_spinner
                        text: "Choose a system"
                        values: ["No Systems Found"]
                        size_hint_y: None
                        height: "40dp"
                        on_touch_down: app.populate_system_selection_spinner()

                    Button:
                        text: 'Set as Active System'
                        size_hint_y: None
                        height: '40dp'
                        on_release: app.update_rr_selected_system(systems_spinner.text)


                Label:
                    text: "Start Auto Site Switching on Boot"
                    size_hint_y: None
                    height: "40dp"
                    halign: "right"
                    valign: "middle"  # Vertical alignment to center the text vertically

                Button:
                    id: auto_on_boot
                    text: 'Send Start Command'
                    size_hint_y: None
                    height: '40dp'
                    on_touch_down: app.test_site_switching(systems_spinner.text)

                Widget:
                    size_hint_y: 0.5
